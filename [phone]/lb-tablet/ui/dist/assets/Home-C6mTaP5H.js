import{u as L,a2 as C,j as n,o as v,a as A,y as f,r as N,k as P,bl as M,N as m,L as o,h as b,bm as O,bn as R,O as T,bj as D,aa as g,bo as _,n as w,i as S,as as y,bp as k,bq as x}from"./index-CFbY8QCl.js";const I=f([]),p=f([]),B=f([]),F=(e,a)=>{switch(e){case"getReport":return M.reports.find(s=>s.id===a);default:return null}},j=(e,a)=>{if(!a)return m("error","No ID provided");P("Ambulance",{action:e,id:a},F(e,a)).then(s=>{if(!s)return m("error",`Failed to fetch  ${e} with ID: ${a}`);switch(e){case"getReport":O.set(s),R.set("reports");break}})};function J(){var a,s;const e=L(C.APPS.AMBULANCE.permissions);return n(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:n("main",{className:"main",style:{padding:"0"},children:A("div",{className:"grid",children:[((a=e==null?void 0:e.report)==null?void 0:a.view)&&n($,{}),((s=e==null?void 0:e.bulletin)==null?void 0:s.view)&&n(q,{}),n(z,{})]})})})}const $=()=>{var E;const e=L(I),a=L(C.APPS.AMBULANCE.permissions),[s,t]=N.useState(""),[c,u]=N.useState("");return N.useEffect(()=>{const l=setTimeout(()=>t(c),500);return()=>clearTimeout(l)},[c]),N.useEffect(()=>{P("Ambulance",{action:"getReports",query:s},M.reports.filter(l=>{var i,r;return((i=l.title)==null?void 0:i.toLowerCase().includes(s==null?void 0:s.toLowerCase()))||((r=l.description)==null?void 0:r.toLowerCase().includes(s==null?void 0:s.toLowerCase()))})).then(l=>{if(!l)return m("warning","getReports did not return any data");I.set(l)})},[s]),A("div",{className:"grid-item full",children:[A("div",{className:"top",children:[n("div",{className:"title",children:o("APPS.AMBULANCE.HOME.RECENT_REPORTS")}),((E=a==null?void 0:a.report)==null?void 0:E.create)&&A("div",{className:"button",onClick:()=>{O.set({}),R.set("reports")},children:[n(b,{}),o("APPS.AMBULANCE.HOME.CREATE")]})]}),n(T,{placeholder:o("APPS.AMBULANCE.REPORTS.SEARCH"),onChange:l=>u(l.target.value)}),n("div",{className:"items",children:e.map(l=>n(v.div,{...D,className:"item home",onClick:()=>j("getReport",l.id),children:A("div",{className:"item-content",children:[n("div",{className:"item-title",children:l.title}),n("div",{className:"item-subtitle",children:l.description.length>100?l.description.substring(0,100)+"...":l.description}),n("div",{className:"item-footer",children:o("APPS.AMBULANCE.HOME.REPORT_FOOTER",{timestamp:g(l.lastUpdated),author:l.author})})]})},l.id))})]})},q=()=>{var l;const e=L(_),a=L(p),s=L(C.APPS.AMBULANCE.permissions),[t,c]=N.useState(""),[u,E]=N.useState("");return N.useEffect(()=>{const i=setTimeout(()=>c(u),500);return()=>clearTimeout(i)},[u]),N.useEffect(()=>{P("Ambulance",{action:"getBulletinBoard",query:t},M.bulletinBoard.filter(i=>{var r,d;return((r=i==null?void 0:i.title)==null?void 0:r.toLowerCase().includes(t==null?void 0:t.toLowerCase()))||((d=i==null?void 0:i.content)==null?void 0:d.toLowerCase().includes(t==null?void 0:t.toLowerCase()))})).then(i=>{if(!i)return m("warning","getBulletinBoard did not return any data");p.set(i)})},[t]),w("ambulance:bulletinDeleted",i=>{if(!i)return m("error","No ID provided in bulletinDeleted event");p.set(p.value.filter(r=>r.id!==i))}),A("div",{className:"grid-item full",children:[A("div",{className:"top",children:[n("div",{className:"title",children:o("APPS.AMBULANCE.HOME.BULLETIN_BOARD")}),((l=s==null?void 0:s.bulletin)==null?void 0:l.create)&&A("div",{className:"button",onClick:()=>{let i,r;S.PopUp.set({title:o("APPS.AMBULANCE.HOME.ADD_BULLETIN.TITLE"),description:o("APPS.AMBULANCE.HOME.ADD_BULLETIN.DESCRIPTION"),input:{placeholder:o("APPS.AMBULANCE.HOME.ADD_BULLETIN.PLACEHOLDER"),onChange:d=>{S.PopUp.value.buttons[0].disabled=d.length<1,i=d}},textarea:{placeholder:o("APPS.AMBULANCE.HOME.ADD_BULLETIN.CONTENT"),onChange:d=>{S.PopUp.value.buttons[0].disabled=d.length<1,r=d}},buttons:[{title:o("APPS.AMBULANCE.HOME.ADD_BULLETIN.CANCEL")},{title:o("APPS.AMBULANCE.HOME.ADD_BULLETIN.PROCEED"),cb:()=>{if(!i||!r)return m("error","Input or Textarea is empty");if(i.length<1||r.length<1)return m("error","Input or Textarea is empty");P("Ambulance",{action:"createBulletin",title:i,content:r},Math.random().toString(36).substring(7)).then(d=>{if(!d)return m("error","Failed to create bulletin");let H=[...p.value,{id:d,title:i,content:r,timestamp:Date.now(),author:e.name,pinned:!1}].sort((h,U)=>h.timestamp===U.timestamp?0:h.timestamp>U.timestamp?-1:1).sort((h,U)=>h.pinned===U.pinned?0:h.pinned?-1:1);p.set(H)})}}]})},children:[n(b,{}),o("APPS.AMBULANCE.ADD")]})]}),n(T,{placeholder:o("APPS.AMBULANCE.HOME.SEARCH_BULLETIN"),onChange:i=>E(i.target.value)}),n("div",{className:"items full",children:a.sort((i,r)=>i.timestamp===r.timestamp?0:i.timestamp>r.timestamp?-1:1).sort((i,r)=>i.pinned===r.pinned?0:i.pinned?-1:1).filter(i=>{var r,d;return((r=i==null?void 0:i.title)==null?void 0:r.toLowerCase().includes(t==null?void 0:t.toLowerCase()))||((d=i==null?void 0:i.content)==null?void 0:d.toLowerCase().includes(t==null?void 0:t.toLowerCase()))}).map((i,r)=>n(V,{data:i},r))})]})},V=({data:e})=>{const a=y(()=>{var s,t,c;!((s=C.APPS.AMBULANCE.permissions.value)!=null&&s.bulletin.pin)&&!(e!=null&&e.created)||S.ContextMenu.set({buttons:[((t=C.APPS.AMBULANCE.permissions.value)==null?void 0:t.bulletin.pin)&&{title:e.pinned?o("APPS.AMBULANCE.HOME.UNPIN"):o("APPS.AMBULANCE.HOME.PIN"),color:e.pinned?"red":null,cb:()=>{P("Ambulance",{action:"toggleBulletinPinned",id:e.id,pinned:!e.pinned},!0).then(u=>{if(!u)return m("error","Failed to toggle pinned bulletin");p.set(p.value.map(E=>E.id===e.id?{...E,pinned:!E.pinned}:E))})}},(e.created||((c=C.APPS.AMBULANCE.permissions.value)==null?void 0:c.bulletin.delete))&&{title:o("APPS.AMBULANCE.HOME.DELETE_BULLETIN.DELETE"),color:"red",cb:()=>{S.PopUp.set({title:o("APPS.AMBULANCE.HOME.DELETE_BULLETIN.TITLE"),description:o("APPS.AMBULANCE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:o("APPS.AMBULANCE.CANCEL")},{title:o("APPS.AMBULANCE.DELETE"),color:"red",cb:()=>{P("Ambulance",{action:"deleteBulletin",id:e.id}).then(u=>{if(!u)return m("error","Failed to delete bulletin");p.set(p.value.filter(E=>E.id!==e.id))})}}]})}}]})});return n(v.div,{...D,...a,className:"item home",onClick:()=>{x.set({title:e.title,content:e.content,footer:`${g(e.timestamp)} - ${e.author}`})},children:A("div",{className:"item-content",children:[e.pinned&&n(k,{}),n("div",{className:"item-title",children:e.title}),n("div",{className:"item-subtitle",children:e.content}),A("div",{className:"item-footer",children:[g(e.timestamp)," - ",e.author]})]})})},z=()=>{const e=L(B),[a,s]=N.useState("");return N.useEffect(()=>{P("Ambulance",{action:"getActiveUnits"},M.activeUnits).then(t=>{if(!t)return m("warning","getActiveUnits did not return any data");B.set(t)})},[]),w("ambulance:updateCallsign",t=>{if(!t)return m("error","No data received for ambulance:updateCallsign");B.set(B.value.map(c=>c.source===t.source?{...c,callsign:t.callsign}:c))}),A("div",{className:"grid-item full",children:[n("div",{className:"top",children:n("div",{className:"title",children:o("APPS.AMBULANCE.HOME.ACTIVE_UNITS")})}),n(T,{placeholder:o("APPS.AMBULANCE.HOME.SEARCH_UNITS"),onChange:t=>s(t.target.value)}),n("div",{className:"items full",children:e.filter(t=>{var c,u;return((c=t==null?void 0:t.callsign)==null?void 0:c.toLowerCase().includes(a.toLowerCase()))||((u=t==null?void 0:t.name)==null?void 0:u.toLowerCase().includes(a==null?void 0:a.toLowerCase()))}).map((t,c)=>A(v.div,{...D,className:"item unit",children:[t.callsign&&n("div",{className:"card green",children:t.callsign}),n("div",{className:"card red",children:t.rank}),n("div",{className:"name",children:t.name})]},c))})]})};export{J as default};
