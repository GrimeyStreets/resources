import{a as g,j as o,Q as X,r as d,R as Y,I as K,L as P,u as S,F as ee,U as te,N,k as re,V as ne,y as C,A as oe,W as se,C as z,X as O,h as ie,Y as ae,Z as ce,_ as le,$ as ue,a0 as de}from"./index-CFbY8QCl.js";function fe({data:e}){return g("div",{className:"bookmark-wrapper",onMouseUp:s=>U(e.url),children:[o(me,{icon:e==null?void 0:e.icon}),o("div",{className:"title",children:e.title})]})}const me=({icon:e})=>e?o("img",{src:e}):o(X,{});function he({active:e}){const[s,r]=d.useState("");return o("div",{className:"empty-tab","data-active":e,children:g("div",{className:"empty-tab-content",children:[o("img",{className:"logo",src:"./assets/img/logo.png"}),g("div",{className:"searchbar",children:[o(Y,{}),o(K,{type:"text",placeholder:P("APPS.BROWSER.SEARCH_PLACEHOLDER"),value:s,onChange:a=>r(a.target.value),onKeyUp:a=>a.key==="Enter"&&U(a.currentTarget.value)})]})]})})}function ve({data:e,active:s,addRef:r}){const a=S(y),[u,b]=d.useState(!1),[h,i]=d.useState(null),v=d.useRef(),E=d.useRef(!0);return d.useEffect(()=>{h&&(v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{h&&Q(e.id,h,E.current),E.current&&(E.current=!1)},250))},[h]),d.useEffect(()=>{b(!1)},[e==null?void 0:e.id,a]),o(ee,{children:u?g("div",{className:"failed-load",children:[o(te,{}),o("div",{className:"subtitle",children:P("APPS.BROWSER.FAILED_LOAD_PAGE")})]}):o("iframe",{ref:T=>r(T),src:e.url,title:e.title,"data-active":s,onLoad:async T=>{await new Promise(f=>setTimeout(f,100));const A=T.target,c=A.contentDocument;if(!c)return N("warning","Failed to load iframe",e.url);if((c==null?void 0:c.head.childElementCount)===0&&s){N("warning","Failed to load iframe"),b(!0);return}i(f=>{var w;return{...f,title:c.title,icon:(w=c.querySelector("link[rel='icon']"))==null?void 0:w.href}}),c.querySelector("title")&&new MutationObserver(w=>{i(p=>({...p,title:c.title}))}).observe(c.querySelector("title"),{subtree:!0,characterData:!0,childList:!0}),A.contentWindow.navigation.addEventListener("navigate",f=>{i(w=>({...w,url:f.destination.url}))}),c.onmouseup=f=>{if(f.button!==0&&f.button!==1)return;const w=c.elementsFromPoint(f.clientX,f.clientY);for(const p of w)if((p==null?void 0:p.tagName)==="A"&&((p==null?void 0:p.target)==="_blank"||f.button===1)){let R=p.href;f.preventDefault(),D(R)}},A.contentWindow.fetchNui=re;const x=c.createElement("script");x.innerHTML=`
                    let addedHandlers = [];

                    function refreshInputs(inputs) {
                        inputs.forEach((input) => {
                            if (addedHandlers.includes(input)) return console.log('already added handler for', input);

                            input.addEventListener('focus', () => fetchNui('toggleInput', true, 'ok'));
                            input.addEventListener('blur', () => fetchNui('toggleInput', false, 'ok'));
                        });
                    }

                    refreshInputs(document.querySelectorAll('input, textarea'));

                    const inputObserver = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            mutation.addedNodes.forEach((node) => {
                                if (node.childNodes.length > 0) refreshInputs(node.querySelectorAll('input, textarea'));
                                if (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA') refreshInputs([node]);
                            });
                        });
                    });

                    inputObserver.observe(document.body, { childList: true, subtree: true });
                `,c.body.appendChild(x)}})})}function pe({data:e}){const[s,r]=d.useState(y.value===e.id),a=S(y);return d.useEffect(()=>{r(e.id===y.value)},[a]),g("div",{className:"tab-wrapper","data-active":s,onClick:()=>y.set(e.id),onMouseUp:u=>{u.button===1&&$(e.id)},children:[g("div",{className:"tab-content",children:[o(ge,{data:e}),o("div",{className:"title",children:e.title})]}),o(ne,{onClick:u=>{u.stopPropagation(),$(e.id)}})]})}function ge({data:e}){return e!=null&&e.icon?o("img",{src:e.icon,onError:s=>{e.id&&Q(e.id,{icon:void 0})}}):o(X,{})}const F={tabs:[{id:"1",title:"LB",url:"https://lbscripts.com"}],bookmarks:[{id:"1",title:"LB",url:"https://lbscripts.com"},{id:"2",title:"Yep",url:"https://www.yep.com"}]},m=C([]).mock(F.tabs),M=localStorage.getItem(`${O.value}-lb-tablet:bookmarks`),be=M?JSON.parse(M):[];var J,j;const y=C(null).mock((j=(J=F.tabs)==null?void 0:J[0])==null?void 0:j.id),I=C(be).mock(F.bookmarks),k=C({}),G=localStorage.getItem(`${O.value}-lb-tablet:browserHistory`),V=C(G?JSON.parse(G):[]);function we(){var p,R;const e=d.useRef([]),s=S(m),r=S(y),a=S(I),u=(p=S(oe))==null?void 0:p.active,[b,h]=d.useState(""),[i,v]=d.useState(!1),[E,T]=d.useState(!1),[A,c]=d.useState(!1),W=t=>{if(t=t??s.find(l=>l.id===r),!(t!=null&&t.url))return;let n=[...I.value,t];I.set(n),localStorage.setItem(`${O.value}-lb-tablet:bookmarks`,JSON.stringify(n)),c(!0)},x=()=>{const t=e.current[r],n=k.value[r];if(!t||!n)return N("warning","No iframe / history found");const l=n.currentIndex;if(l===0)return N("warning","Already at first page");t.src=n.history[l-1],n.currentIndex=l-1,k.patch({[r]:n})},f=()=>{const t=e.current[r],n=k.value[r];if(!t||!n)return N("warning","No iframe / history found");const l=n.currentIndex;if(l===n.history.length-1)return N("warning","Already at last page");t.src=n.history[l+1],n.currentIndex=l+1,k.patch({[r]:n})},w=()=>{var n;const t=e.current[r];t&&((n=t.contentWindow)==null||n.location.reload())};return d.useEffect(()=>{var t;if(se("Browser"))return m.value.length===0&&D(),I.set([...((t=z.value.Browser)==null?void 0:t.DefaultBookmarks)??[],...I.value.filter(n=>{var _,q;let l=!n.id,L=l&&!((q=(_=z.value.Browser)==null?void 0:_.DefaultBookmarks)!=null&&q.find(H=>H.url===n.url)),B=l&&I.value.find(H=>H.url===n.url);return!L&&!B})]),()=>{let n=V.value;localStorage.setItem(`${O.value}-lb-tablet:browserHistory`,JSON.stringify(n))}},[u]),d.useEffect(()=>{var n,l,L;const t=m.value.find(B=>B.id===y.value);t&&(v(((n=k.value[r])==null?void 0:n.currentIndex)!==0),T(((l=k.value[r])==null?void 0:l.currentIndex)!==((L=k.value[r])==null?void 0:L.history.length)-1)),h((t==null?void 0:t.url)??""),c(!!I.value.find(B=>B.url===(t==null?void 0:t.url)))},[r,s]),g("div",{className:"browser-container",children:[g("div",{className:"browser-header",children:[g("div",{className:"tab-container",children:[s.map((t,n)=>o(pe,{data:t},n)),o("div",{className:"tab-add",children:o(ie,{onClick:()=>D()})})]}),g("div",{className:"search-container",children:[g("div",{className:"actions",children:[o(ae,{"data-disabled":!i,onClick:x}),o(ce,{"data-disabled":!E,onClick:f}),o(le,{"data-disabled":!r,onClick:w})]}),g("div",{className:"searchbar",children:[o(Y,{}),o(K,{type:"text",value:b,placeholder:((R=s.find(t=>t.id===r))==null?void 0:R.url)??P("APPS.BROWSER.SEARCH_PLACEHOLDER"),onFocusCapture:t=>t.currentTarget.select(),onKeyUp:t=>{t.key==="Enter"&&U(t.currentTarget.value)},onChange:t=>h(t.currentTarget.value)}),A?o(ue,{className:"bookmark","data-disabled":!r,onClick:()=>{I.set(I.value.filter(t=>t.url!==b)),c(!1)}}):o(de,{className:"bookmark","data-disabled":!r,onClick:()=>W()})]})]}),o("div",{className:"bookmark-container",children:a.map((t,n)=>o(fe,{data:t},n))})]}),o("div",{className:"browser-content",children:s.map((t,n)=>t.url?o(ve,{data:t,active:t.id===r,addRef:l=>e.current[t.id]=l},t.id):o(he,{active:t.id===r},t.id))})]})}const ke=e=>{if(!e)return N("warning","No data provided to add to long history, returning");V.push({icon:e.icon,title:e.title,link:e.url,date:Date.now()})},U=e=>{e&&(e=Z(e)?e:"https://yep.com/web?q="+encodeURIComponent(e));const s=y.value;m.set([...m.value.map(r=>r.id===s?{...r,url:e}:r)])},D=e=>{e&&(e=Z(e)?e:"https://yep.com/web?q="+encodeURIComponent(e));const s=crypto.randomUUID(),r={id:s,url:e,title:e??"New Tab"};k.patch({[s]:{history:[e],currentIndex:0}}),m.push(r),y.set(s)},$=e=>{var s,r;if(m.value.length===1&&D(),y.value===e){const a=m.value.findIndex(b=>b.id===e),u=((s=m.value[a+1])==null?void 0:s.id)??((r=m.value[a-1])==null?void 0:r.id);y.set(u)}m.set([...m.value.filter(a=>a.id!==e)]),k.patch({[e]:void 0})},Q=(e,s,r)=>{let a=r===!0,{title:u,icon:b,link:h}=s;const i=m.value.find(v=>v.id===e);if(i){if(u&&(u.length>20&&(u=u.substring(0,20)+"..."),i&&i.title!==u&&(i.title=u)),b&&(i==null?void 0:i.icon)!==b&&(i.icon=b),h&&(i==null?void 0:i.url)!==h){i.url=h;const v=k.value[e].history;k.patch({[e]:{history:[...v,h],currentIndex:v.length}}),a=!0}a&&ke(i),m.set([...m.value.filter(v=>v.id!==e),i])}},Z=e=>e?new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e):!1;export{y as ActiveTab,I as Bookmarks,V as LongHistory,k as TabHistory,m as Tabs,D as addTab,we as default,$ as removeTab,U as setTab,Q as updateTabData};
