import{u as p,j as s,o as O,a as o,a2 as N,y as T,r as d,k as L,bu as S,N as P,L as l,h as w,bv as B,bw as f,O as R,bj as D,aa as b,bx as x,n as M,i as I,by as k,bz as W,as as F,bp as $,bA as j}from"./index-CFbY8QCl.js";const U=T([]),h=T([]),H=T([]),g=T([]),q=(e,a)=>{switch(e){case"getReport":return S.reports.find(n=>n.id===a);case"getWarrant":return S.warrants.find(n=>n.id===a);default:return null}},y=(e,a)=>{if(!a)return P("error","No ID provided");L("Police",{action:e,id:a},q(e,a)).then(n=>{if(!n)return P("error",`Failed to fetch ${e} with ID: ${a}`);switch(e){case"getReport":B.set(n),f.set("reports");break;case"getWarrant":k.set(n),f.set("warrants");break;default:P("error",`Unknown event: ${e}`);break}})};function X(){var a,n,i;const e=p(N.APPS.POLICE.permissions);return s(O.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:s("main",{className:"main",style:{padding:"0"},children:o("div",{className:"grid",children:[((a=e==null?void 0:e.report)==null?void 0:a.view)!==!1&&s(z,{}),((n=e==null?void 0:e.bulletin)==null?void 0:n.view)!==!1&&s(V,{}),s(K,{}),((i=e==null?void 0:e.warrant)==null?void 0:i.view)!==!1&&s(J,{})]})})})}const z=()=>{var u;const e=p(U),a=p(N.APPS.POLICE.permissions),[n,i]=d.useState(""),[c,E]=d.useState("");return d.useEffect(()=>{const t=setTimeout(()=>i(c),500);return()=>clearTimeout(t)},[c]),d.useEffect(()=>{L("Police",{action:"getReports",query:n},S.reports.filter(t=>t.title.toLowerCase().includes(n.toLowerCase())||t.description.toLowerCase().includes(n.toLowerCase()))).then(t=>{if(!t)return P("warning","getReports did not return any data");U.set(t)})},[n]),o("div",{className:"grid-item",children:[o("div",{className:"top",children:[s("div",{className:"title",children:l("APPS.POLICE.HOME.RECENT_REPORTS")}),((u=a==null?void 0:a.report)==null?void 0:u.create)&&o("div",{className:"button",onClick:()=>{B.set({}),f.set("reports")},children:[s(w,{}),l("APPS.POLICE.HOME.CREATE")]})]}),s(R,{placeholder:l("APPS.POLICE.REPORTS.SEARCH"),onChange:t=>E(t.target.value)}),s("div",{className:"items",children:e.map(t=>s(O.div,{...D,className:"item home",onClick:()=>y("getReport",t.id),children:o("div",{className:"item-content",children:[s("div",{className:"item-title",children:t.title}),s("div",{className:"item-subtitle",children:t.description.length>100?t.description.substring(0,100)+"...":t.description}),s("div",{className:"item-footer",children:l("APPS.POLICE.HOME.REPORT_FOOTER",{timestamp:b(t.lastUpdated),author:t.author})})]})},t.id))})]})},V=()=>{var t;const e=p(x),a=p(h),n=p(N.APPS.POLICE.permissions),[i,c]=d.useState(""),[E,u]=d.useState("");return d.useEffect(()=>{const r=setTimeout(()=>c(E),500);return()=>clearTimeout(r)},[E]),d.useEffect(()=>{L("Police",{action:"getBulletinBoard",query:i},S.bulletinBoard.filter(r=>r.title.toLowerCase().includes(i.toLowerCase())||r.content.toLowerCase().includes(i.toLowerCase()))).then(r=>{if(!r)return P("warning","getBulletinBoard did not return any data");h.set(r)})},[i]),M("police:bulletinDeleted",r=>{if(!r)return P("error","No ID provided in bulletinDeleted event");h.set(h.value.filter(m=>m.id!==r))}),o("div",{className:"grid-item full",children:[o("div",{className:"top",children:[s("div",{className:"title",children:l("APPS.POLICE.HOME.BULLETIN_BOARD")}),((t=n==null?void 0:n.bulletin)==null?void 0:t.create)&&o("div",{className:"button",onClick:()=>{let r,m;I.PopUp.set({title:l("APPS.POLICE.HOME.ADD_BULLETIN.TITLE"),description:l("APPS.POLICE.HOME.ADD_BULLETIN.DESCRIPTION"),input:{placeholder:l("APPS.POLICE.HOME.ADD_BULLETIN.PLACEHOLDER"),onChange:C=>{I.PopUp.value.buttons[0].disabled=C.length<1,r=C}},textarea:{placeholder:l("APPS.POLICE.HOME.ADD_BULLETIN.CONTENT"),onChange:C=>{I.PopUp.value.buttons[0].disabled=C.length<1,m=C}},buttons:[{title:l("APPS.POLICE.HOME.ADD_BULLETIN.CANCEL")},{title:l("APPS.POLICE.HOME.ADD_BULLETIN.PROCEED"),cb:()=>{if(!r||!m)return P("error","Input or Textarea is empty");if(r.length<1||m.length<1)return P("error","Input or Textarea is empty");L("Police",{action:"createBulletin",title:r,content:m},Math.random().toString(36).substring(7)).then(C=>{if(!C)return P("error","Failed to create bulletin");let _=[...h.value,{id:C,title:r,content:m,timestamp:Date.now(),author:e.name,pinned:!1}].sort((v,A)=>v.timestamp===A.timestamp?0:v.timestamp>A.timestamp?-1:1).sort((v,A)=>v.pinned===A.pinned?0:v.pinned?-1:1);h.set(_)})}}]})},children:[s(w,{}),l("APPS.POLICE.ADD")]})]}),s(R,{placeholder:l("APPS.POLICE.HOME.SEARCH_BULLETIN"),onChange:r=>u(r.target.value)}),s("div",{className:"items full",children:a.sort((r,m)=>r.timestamp===m.timestamp?0:r.timestamp>m.timestamp?-1:1).sort((r,m)=>r.pinned===m.pinned?0:r.pinned?-1:1).filter(r=>r.title.toLowerCase().includes(i.toLowerCase())||r.content.toLowerCase().includes(i.toLowerCase())).map((r,m)=>s(G,{data:r},m))})]})},G=({data:e})=>{p(W);const a=F(()=>{var n,i,c;!((n=N.APPS.POLICE.permissions.value)!=null&&n.bulletin.pin)&&!(e!=null&&e.created)||I.ContextMenu.set({buttons:[((i=N.APPS.POLICE.permissions.value)==null?void 0:i.bulletin.pin)&&{title:e.pinned?l("APPS.POLICE.HOME.UNPIN"):l("APPS.POLICE.HOME.PIN"),color:e.pinned?"red":null,cb:()=>{L("Police",{action:"toggleBulletinPinned",id:e.id,pinned:!e.pinned},!0).then(E=>{if(!E)return P("error","Failed to toggle pinned bulletin");h.set(h.value.map(u=>u.id===e.id?{...u,pinned:!u.pinned}:u))})}},(e.created||((c=N.APPS.POLICE.permissions.value)==null?void 0:c.bulletin.delete))&&{title:l("APPS.POLICE.HOME.DELETE_BULLETIN.DELETE"),color:"red",cb:()=>{I.PopUp.set({title:l("APPS.POLICE.HOME.DELETE_BULLETIN.TITLE"),description:l("APPS.POLICE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:l("APPS.POLICE.CANCEL")},{title:l("APPS.POLICE.DELETE"),color:"red",cb:()=>{L("Police",{action:"deleteBulletin",id:e.id}).then(E=>{if(!E)return P("error","Failed to delete bulletin");h.set(h.value.filter(u=>u.id!==e.id))})}}]})}}]})});return s(O.div,{...D,...a,className:"item home",onClick:()=>{j.set({title:e.title,content:e.content,footer:`${b(e.timestamp)} - ${e.author}`})},children:o("div",{className:"item-content",children:[e.pinned&&s($,{}),s("div",{className:"item-title",children:e.title}),s("div",{className:"item-subtitle",children:e.content}),o("div",{className:"item-footer",children:[b(e.timestamp)," - ",e.author]})]})})},J=()=>{var u;const e=p(H),a=p(N.APPS.POLICE.permissions),[n,i]=d.useState(""),[c,E]=d.useState("");return d.useEffect(()=>{const t=setTimeout(()=>i(c),500);return()=>clearTimeout(t)},[c]),d.useEffect(()=>{L("Police",{action:"getWarrants",query:n},S.warrants.filter(t=>t.title.toLowerCase().includes(n.toLowerCase())||t.description.toLowerCase().includes(n.toLowerCase()))).then(t=>{if(!t)return P("warning","getReports did not return any data");H.set(t)})},[n]),o("div",{className:"grid-item",children:[o("div",{className:"top",children:[s("div",{className:"title",children:l("APPS.POLICE.HOME.RECENT_WARRANTS")}),((u=a==null?void 0:a.warrant)==null?void 0:u.create)&&o("div",{className:"button",onClick:()=>{k.set({}),f.set("warrants")},children:[s(w,{}),l("APPS.POLICE.HOME.CREATE")]})]}),s(R,{placeholder:l("APPS.POLICE.WARRANTS.SEARCH"),onChange:t=>E(t.target.value)}),s("div",{className:"items",children:e.map(t=>d.createElement(O.div,{...D,key:t.id,className:"item home",onClick:()=>{y("getWarrant",t.id)}},o("div",{className:"item-content",children:[s("div",{className:"item-title",children:t.title}),s("div",{className:"item-subtitle",children:t.description.substring(0,100)}),o("div",{className:"item-footer",children:[b(t.lastUpdated)," - ",t.author]})]})))})]})},K=()=>{const e=p(g),[a,n]=d.useState("");return d.useEffect(()=>{L("Police",{action:"getActiveUnits"},S.activeUnits).then(i=>{if(!i)return P("warning","getActiveUnits did not return any data");g.set(i)})},[]),M("police:updateCallsign",i=>{if(!i)return P("error","No data received for police:updateCallsign");g.set(g.value.map(c=>c.source===i.source?{...c,callsign:i.callsign}:c))}),o("div",{className:"grid-item full",children:[s("div",{className:"top",children:s("div",{className:"title",children:l("APPS.POLICE.HOME.ACTIVE_UNITS")})}),s(R,{placeholder:l("APPS.POLICE.HOME.SEARCH_UNITS"),onChange:i=>n(i.target.value)}),s("div",{className:"items full",children:e.filter(i=>{var c;return((c=i==null?void 0:i.callsign)==null?void 0:c.toLowerCase().includes(a.toLowerCase()))||(i==null?void 0:i.name.toLowerCase().includes(a.toLowerCase()))}).map((i,c)=>o(O.div,{...D,className:"item unit",children:[i.callsign&&s("div",{className:"card green",children:i.callsign}),s("div",{className:"card blue",children:i.rank}),s("div",{className:"name",children:i.name})]},c))})]})};export{X as default};
