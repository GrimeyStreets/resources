import{r as E,a as C,F as te,j as e,aj as he,y as q,u as R,a2 as f,a1 as ve,A as fe,W as J,N as v,k as M,ar as U,L as o,as as Ae,i as H,o as x,p as ae,h as Se,af as X,at as Oe,aq as W,au as ce,s as ge,av as Ce,aw as Ee,ax as pe,ay as Te,az as be,P as de,C as Q,aA as Me,aB as Ie,aC as ue,al as Ne,b as j,a8 as oe,a7 as ie,aD as Pe,ac as Z,aE as ye,aF as Re,aG as Le,S as me,aH as He}from"./index-CFbY8QCl.js";const $=({src:t,showAdvanced:c})=>{const[r,A]=E.useState(null);return C(te,{children:[e("video",{src:t,crossOrigin:"anonymous",controls:!1,onMouseOver:N=>{c&&N.currentTarget.play()},onMouseOut:N=>{c&&N.currentTarget.pause()},muted:!0,loop:!0,onLoadedMetadata:N=>{A(N.currentTarget.duration)}}),r&&c&&e("div",{className:"video-duration",children:(N=>{const I=Math.floor(N/60),O=he(N-I*60,0);return`${I}:${O<10?"0"+O:O}`})(r)})]})},_=q(null),z=[{title:o("APPS.PHOTOS.VIDEOS"),id:"videos",icon:e(Ce,{}),count:0},{title:o("APPS.PHOTOS.SELFIES"),id:"selfies",icon:e(Ee,{}),count:0},{title:o("APPS.PHOTOS.SCREENSHOTS"),id:"screenshots",icon:e(pe,{}),count:0},{title:o("APPS.PHOTOS.IMPORTS"),id:"imports",icon:e(Te,{}),count:0},{title:o("APPS.PHOTOS.DUPLICATES"),id:"duplicates",icon:e(be,{}),count:0}];function _e(){const t=R(_),[c,r]=E.useState(!1),A=R(f.APPS.CAMERA.albums),T=R(f.APPS.CAMERA.mediaTypes),N=R(ve),I=R(fe),O=E.useRef(null);E.useEffect(()=>{var d,g;if(J("Photos")){if(((d=f.APPS.CAMERA.albums.value)==null?void 0:d.length)>0&&((g=f.APPS.CAMERA.mediaTypes.value)==null?void 0:g.length)>0)return v("info","Album and mediatype cache exists, returning");M("Camera",{action:"getAlbums"},{albums:U.Albums,mediaTypes:U.MediaTypes}).then(b=>{if(!b)return v("error","No data received from server");let n=(T.length>0?T:z).map(m=>{const S=b.mediaTypes[m.id+"Photos"]??0,h=b.mediaTypes[m.id+"Videos"]??0;return{...m,count:S+h,videoCount:h,photoCount:S}});f.APPS.CAMERA.albums.set(b.albums),f.APPS.CAMERA.mediaTypes.set(n)})}},[t]),E.useEffect(()=>{if(!J("Photos"))return;let d=A.find(g=>g.id==="phone");N?M("Camera",{action:"getPhoneAlbum"},{cover:U.PhonePhotos[0].src,count:U.PhonePhotos.length,photoCount:U.PhonePhotos.filter(g=>!g.isVideo).length,videoCount:U.PhonePhotos.filter(g=>g.isVideo).length}).then(g=>{if(!g)return v("error","No data received from server");g.id="phone",g.title="From my phone",g.removable=!1,setTimeout(()=>{d?f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(b=>b.id==="phone"?g:b)):f.APPS.CAMERA.albums.set([...f.APPS.CAMERA.albums.value,g])},100)}):setTimeout(()=>{d&&f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.filter(g=>g.id!=="phone"))},100)},[I==null?void 0:I.active]),E.useEffect(()=>O!=null&&O.current?(O.current.addEventListener("wheel",d=>{d.preventDefault(),O.current.scrollLeft+=d.deltaY}),()=>{O!=null&&O.current&&(O==null||O.current.removeEventListener("wheel",d=>{d.preventDefault(),O.current.scrollLeft+=d.deltaY}))}):v("warning","Scroll container not found"),[O==null?void 0:O.current]);const G=()=>{let d="";H.PopUp.set({title:o("APPS.PHOTOS.NEW_ALBUM_POPUP.TITLE"),description:o("APPS.PHOTOS.NEW_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:o("APPS.PHOTOS.NEW_ALBUM_POPUP.PLACEHOLDER"),maxCharacters:20,onChange:g=>{d=g}},buttons:[{title:o("APPS.PHOTOS.NEW_ALBUM_POPUP.CANCEL")},{title:o("APPS.PHOTOS.NEW_ALBUM_POPUP.PROCEED"),cb:()=>{M("Camera",{action:"createAlbum",title:d},{id:Math.floor(Math.random()*1e3).toString()}).then(g=>{if(!g)return v("warning","Could not create album, id not returned");if(d.length<1)return v("warning","Input is empty, cannot create album");if(d.length>20)return v("warning","Input is too long, cannot create album");let b={title:d,id:g,cover:null,count:0,photoCount:0,videoCount:0};f.APPS.CAMERA.albums.set([...A,b])})}}]})},P=d=>{if(!d)return v("warning","No album id provided, cannot remove album");H.PopUp.set({title:o("APPS.PHOTOS.REMOVE_ALBUM.TITLE",{name:d.title}),description:o("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION",{name:d.title}),buttons:[{title:o("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:o("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{M("Camera",{action:"deleteAlbum",id:d.id},!0).then(g=>{if(!g)return v("error","Could not remove album, server returned false");f.APPS.CAMERA.albums.set(A.filter(b=>b.id!==d.id))})}}]})},w=d=>d?d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):0,B=Ae(d=>{let g=d.target;for(;!g.classList.contains("album");)g=g.parentElement;let b=g.getAttribute("data-id");if(!b)return v("warning","Could not obtain album id from element");b==="favourites"||b==="recents"||b==="phone"||H.ContextMenu.set({buttons:[{title:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let p="";H.PopUp.set({title:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:n=>{p=n}},buttons:[{title:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(p.length<1)return v("warning","Input is empty, cannot rename album");v("warning","Renaming album",b,p),M("Camera",{action:"renameAlbum",id:b,title:p},!0).then(n=>{if(!n)return v("error","Could not rename album, server returned false");f.APPS.CAMERA.albums.set(A.map(m=>m.id===b?{...m,title:p}:m))})}}]})}},{title:o("APPS.PHOTOS.DELETE"),color:"red",cb:()=>P(A.find(p=>p.id===b))}]})});return e(x.div,{...ae("right",t?"inAlbum":"albums"),style:{height:"100%",paddingBottom:"9rem"},children:t?e(X,{children:e(Ue,{})}):C(te,{children:[C("div",{className:"albums-header",children:[C("div",{className:"top",children:[e(Se,{onClick:G}),e("div",{className:"edit",onClick:()=>r(!c),children:c?o("APPS.PHOTOS.DONE"):o("APPS.PHOTOS.EDIT")})]}),e("div",{className:"title",children:o("APPS.PHOTOS.ALBUMS")})]}),C("div",{className:"albums-content",children:[e("div",{className:"subtitle",children:o("APPS.PHOTOS.MY_ALBUMS")}),e("div",{className:"albums-grid","data-edit":c,ref:O,style:{overflowX:A.length>8?"auto":"hidden"},children:e(X,{children:A.map((d,g)=>C(x.div,{animate:{scale:1},exit:{scale:.2},transition:{duration:.25,ease:"easeInOut"},className:"album","data-id":d.id,"data-removable":d.removable,...B,onClick:()=>{c||_.set(d)},children:[c&&d.removable!==!1&&e("div",{className:"remove",onClick:b=>{b.stopPropagation(),P(d)},children:e(Oe,{})}),C("div",{className:"cover",children:[W(d.cover)?e($,{src:d.cover,showAdvanced:!1}):e("img",{src:d.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"}),d.id==="favourites"&&e(ce,{})]}),C("div",{className:"text",children:[e("div",{className:"title",children:d.title}),e("div",{className:"count",children:w(d.count)})]})]},g))})})]}),e("div",{className:"divider"}),C("div",{className:"media-types",children:[e("div",{className:"subtitle",children:o("APPS.PHOTOS.MEDIA_TYPES")}),e("div",{className:"media-types-items",children:T.map((d,g)=>C("div",{className:"item",onClick:()=>{if(c)return v("info","Edit mode is enabled, cannot open media type");_.set({...d,id:null,cover:null,type:d.id})},children:[C("div",{className:"type",children:[d.icon,d.title]}),C("div",{className:"action",children:[e("div",{className:"count",children:d.count}),e(ge,{})]})]},g))})]})]})})}const Ue=()=>{var g,b;const t=R(_),c=R(D),[r,A]=E.useState([]),[T,N]=E.useState([]),[I,O]=E.useState(!1),[G,P]=E.useState(!1),[w,B]=E.useState(!1);E.useEffect(()=>{let p=t.id==="favourites"?U.Photos.filter(n=>n.favourite):t.id==="recents"?U.Photos:t.type==="videos"?U.Photos.filter(n=>n.isVideo):t.type?U.Photos.filter(n=>n.type===t.type):U.Photos.filter(n=>n.album===t.id)?t.id==="phone"?U.PhonePhotos:U.Photos.filter(n=>n.album===t.id):[];M("Camera",{action:"getImages",filter:t.id!=="phone"?{album:t.id,type:t.type}:null},p,t.id==="phone").then(n=>{if(!n)return v("warning","No data was returned from getImages event");N(n.reverse()),O(n.length===0)})},[]);const d=p=>{if(G||w)return;let n=document.querySelector("#last");if(!n)return;if(!Z(n)){const S=document.querySelector(".library-content");S||v("warning","Could not find library content element");const h=S==null?void 0:S.scrollHeight;B(!0),M("Camera",{action:"getImages",lastId:T[T.length-1].id,filter:t.id!=="phone"?{album:t.id,type:t.type}:{perPage:30}},null,t.id==="phone").then(l=>{l&&l.length>0?(S.style.transform=`translateY(${h}px)`,N(u=>[...l.reverse(),...u]),B(!1),requestAnimationFrame(()=>{S.style.transition="transform 0ms",S.style.transform="translateY(0)"}),l.length<30&&P(!0)):P(!0)})}};return C(x.div,{initial:{opacity:0,x:35},animate:{opacity:1,x:0},exit:{opacity:0,x:35},transition:{duration:.25,ease:"easeInOut"},children:[C("div",{className:"library-header",children:[C("div",{className:"top",children:[e("div",{className:"info",children:C("div",{className:"back",style:{color:T.length<15?"var(--tablet-color-blue)":"#ffffff"},onClick:()=>{c&&D.set(!1),_.set(null)},children:[e(de,{}),o("APPS.PHOTOS.ALBUMS")]})}),C("div",{className:"actions",style:{color:T.length<15?"var(--tablet-color-blue)":"var(--tablet-text-primary)"},children:[e("div",{className:"button",onClick:()=>D.set(!c),children:c?o("APPS.PHOTOS.DONE"):o("APPS.PHOTOS.SELECT")}),((b=(g=Q.value)==null?void 0:g.AllowExternal)==null?void 0:b.Gallery)||t.id!=="favourites"&&t.id!=="recents"&&t.id!=="phone"&&e("div",{className:"button round",onClick:()=>{var m,S;let p=t.id!=="recents"&&t.id!=="favourites",n=((S=(m=Q.value)==null?void 0:m.AllowExternal)==null?void 0:S.Gallery)&&t.id!=="favourites";if(!p&&!n)return v("warning","Cannot edit or import images in this album");H.ContextMenu.set({buttons:[n&&{title:o("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),cb:()=>{let h="";H.PopUp.set({title:o("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),description:o("APPS.PHOTOS.IMPORT_IMAGE_POPUP.DESCRIPTION"),input:{placeholder:o("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PLACEHOLDER"),onChange:l=>{h=l}},buttons:[{title:o("APPS.PHOTOS.IMPORT_IMAGE_POPUP.CANCEL")},{title:o("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PROCEED"),cb:()=>{if(h.includes("data:image"))return v("warning","Data URL not supported");if(!Ie(h)){setTimeout(()=>{H.PopUp.set({title:o("COMPONENTS.GALLERY.EXTERNAL_URL"),description:o("COMPONENTS.GALLERY.EXTERNAL_URL_BLACKLISTED"),buttons:[{title:"OK"}]}),v("warning","External URL is blacklisted")},500);return}ue(h,l=>{if(!l)return v("error","Image does not exist");Ne(h,null,"import",!0).then(u=>{if(!u)return v("error","Could not save to gallery, server returned false");let s=W(h);N([{id:u,src:h,timestamp:Date.now(),type:"import",isVideo:s},...T]),t.id!=="recents"&&t.id!=="favourites"?M("Camera",{action:"addToAlbum",album:t.id,ids:[u]}).then(i=>{if(!i)return v("error","Could not add to album, server returned false");let a=t.photoCount+1,y=s?t.videoCount+1:t.videoCount;_.set({...t,photoCount:a,videoCount:y,cover:h})}):t.id==="favourites"&&M("Camera",{action:"toggleFavourites",ids:[u],favourite:!0}).then(i=>{if(!i)return v("error","Could not add to favourites, server returned false");let a=t.photoCount+1,y=s?t.videoCount+1:t.videoCount;_.set({...t,photoCount:a,videoCount:y,cover:h})}),M("Camera",{action:"getAlbums"}).then(i=>{if(!i)return v("error","No data received from server");let a=z.map(y=>{const L=i.mediaTypes[y.id+"Photos"]??0,k=i.mediaTypes[y.id+"Videos"]??0;return{...y,count:L+k,photoCount:L,videoCount:k}});f.APPS.CAMERA.albums.set(i.albums),f.APPS.CAMERA.mediaTypes.set(a)})})})}}]})}},p&&{title:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let h="";H.PopUp.set({title:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:l=>{h=l}},buttons:[{title:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:o("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(h.length<1)return v("warning","Input is empty, cannot rename album");v("info","Renaming album",t.id,h),M("Camera",{action:"renameAlbum",id:t.id,title:h},!0).then(l=>{if(!l)return v("error","Could not rename album, server returned false");_.set({...t,title:h}),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(u=>u.id===t.id?{...u,title:h}:u))})}}]})}},p&&{title:o("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{H.PopUp.set({title:o("APPS.PHOTOS.REMOVE_ALBUM.TITLE",{name:t.title}),description:o("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION",{name:t.title}),buttons:[{title:o("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:o("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{M("Camera",{action:"deleteAlbum",id:t.id},!0).then(h=>{if(!h)return v("error","Could not remove album, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.filter(l=>l.id!==t.id)),_.set(null)})}}]})}}]})},children:e(Me,{})})]})]}),e("div",{className:"name",style:{color:T.length<15?"var(--tablet-text-primary)":"#ffffff"},children:t.title})]}),C("div",{className:"library-content","data-offset":T.length<15,onScroll:d,"data-no-photos":I,children:[I&&C("div",{className:"no-photos",children:[e("div",{className:"title",children:o("APPS.PHOTOS.NO_PHOTOS")}),e("div",{className:"description",children:o("APPS.PHOTOS.NO_PHOTOS_INSTRUCTIONS")})]}),!c&&t.photoCount!==void 0&&!I&&e(te,{children:C("div",{className:"info",children:[o("APPS.PHOTOS.PHOTO_COUNT",{amount:t.photoCount.toString()}),", ",o("APPS.PHOTOS.VIDEO_COUNT",{amount:t.videoCount.toString()})]})}),e("div",{className:"library-grid",children:T.map((p,n)=>C("div",{id:n===0?"last":"",className:"grid-item",onClick:()=>{if(c){const S=r.find(h=>h.id===p.id);A(S?r.filter(h=>h.id!==p.id):[...r,p])}else V.set({activeImage:p,images:T})},children:[p.isVideo?e($,{src:p.src,showAdvanced:!c}):e("div",{className:"img",style:{backgroundImage:`url(${p.src})`}}),e("div",{className:"checkbox",children:c&&(r.find(S=>S.id===p.id)?e(j,{checked:!0}):e(j,{checked:!1}))})]},n))})]}),c&&C("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":r.length===0,children:e(oe,{})}),e("div",{className:"title",children:r.length===0?o("APPS.PHOTOS.SELECT_ITEMS"):o("APPS.PHOTOS.SELECTED_COUNT",{count:r.length})}),C("div",{className:"icons","data-disabled":r.length===0,children:[e(ie,{onClick:()=>{if(r.length===0)return;let p=t.id!=="recents"&&t.id!=="favourites"&&t.id!=="phone";H.ContextMenu.set({title:p&&o("APPS.PHOTOS.DELETE_CONTEXT_TITLE",{type:r.length>1?o("APPS.PHOTOS.THESE_PHOTOS"):o("APPS.PHOTOS.THIS_PHOTO")}),buttons:[p&&{title:o("APPS.PHOTOS.REMOVE_FROM_ALBUM"),cb:()=>{M("Camera",{action:"removeFromAlbum",album:t.id,ids:r.map(n=>n.id)}).then(n=>{if(!n)return v("error","Could not remove from album, server returned false");let m=t.photoCount-r.filter(h=>!h.isVideo).length,S=t.videoCount-r.filter(h=>h.isVideo).length;f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(h=>{if(h.id===t.id)return{...h,count:h.count-r.length,photoCount:m,videoCount:S}})),_.set({...t,photoCount:m,videoCount:S}),N(T.filter(h=>!r.find(l=>h.id===l.id))),A([]),D.set(!1)})}},{title:o("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{M("Camera",{action:"deleteFromGallery",ids:r.map(n=>n.id)},!0,t.id==="phone").then(n=>{if(!n)return v("error","Could not delete from gallery, server returned false");let m=0;r.forEach(l=>{m+=l.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:m});let S=t.photoCount-r.filter(l=>!l.isVideo).length,h=t.videoCount-r.filter(l=>l.isVideo).length;M("Camera",{action:"getAlbums"}).then(l=>{if(!l)return v("error","No data received from server");let u=z.map(s=>{const i=l.mediaTypes.find(a=>a.id===s.id);return i?{...s,count:i.count}:s});f.APPS.CAMERA.albums.set(l.albums),f.APPS.CAMERA.mediaTypes.set(u)}),_.set({...t,photoCount:S,videoCount:h}),N(T.filter(l=>!r.find(u=>l.id===u.id))),A([]),D.set(!1)})}}]})}}),e(Pe,{onClick:()=>{if(r.length===0)return;let p=r.find(n=>!n.favourite);H.ContextMenu.set({buttons:[t.id!=="phone"&&{title:o("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{F.set({images:r,onSelect:n=>{M("Camera",{action:"addToAlbum",album:n.id,ids:r.map(m=>m.id)},!0).then(m=>{if(!m)return v("error","Could not add to album, server returned false");A([]),D.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(S=>S.id===n.id?{...S,count:S.count+r.length,photoCount:S.photoCount+r.filter(h=>!h.isVideo).length,videoCount:S.videoCount+r.filter(h=>h.isVideo).length,cover:r[r.length-1].src}:S))})}})}},t.id!=="phone"&&{title:p?o("APPS.PHOTOS.ADD_TO_FAVOURITES"):o("APPS.PHOTOS.REMOVE_FROM_FAVOURITES"),cb:()=>{M("Camera",{action:"toggleFavourites",ids:r.map(n=>n.id),favourite:!!p},!0).then(n=>{if(!n)return v("error","Could not add to favourites, server returned false");A([]),D.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(m=>m.id==="favourites"?{...m,count:m.count+r.length,photoCount:m.photoCount+r.filter(S=>!S.isVideo).length,videoCount:m.videoCount+r.filter(S=>S.isVideo).length,cover:r[r.length-1].src}:m))})}},t.id==="phone"&&{title:"Add to Tablet",cb:()=>{M("Camera",{action:"importFromPhone",ids:r.map(n=>n.id)},!0).then(n=>{if(!n)return v("error","Could not add to tablet, server returned false");A([]),D.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(m=>m.id==="recents"?{...m,count:m.count+r.length,photoCount:m.photoCount+r.filter(S=>!S.isVideo).length,videoCount:m.videoCount+r.filter(S=>S.isVideo).length,cover:r[r.length-1].src}:m))})}}]})}})]})]})]})};o("APPS.PHOTOS.YEARS"),o("APPS.PHOTOS.MONTHS"),o("APPS.PHOTOS.DAYS"),o("APPS.PHOTOS.ALL_PHOTOS");function De(){const t=R(D),[c,r]=E.useState([]),[A,T]=E.useState([]),[N,I]=E.useState(!1),[O,G]=E.useState("all"),[P,w]=E.useState(null),[B,d]=E.useState(!1),[g,b]=E.useState(!1),[p,n]=E.useState(0),m=()=>{var se,re;let l=[],u=document.querySelectorAll(".grid-item");if(u.length===0||(u.forEach(Y=>{!Z(Y)&&l.push(Y)}),l.length===0))return w(null);let s=l[0],i=parseInt(s==null?void 0:s.getAttribute("data-id"));if(!i)return;let a=(se=A.find(Y=>Y.id===i))==null?void 0:se.timestamp,y=l[l.length-1],L=parseInt(y.getAttribute("data-id")),k;if(L&&(k=(re=A.find(Y=>Y.id===L))==null?void 0:re.timestamp),!a)return;let K=S(a),ne=S(k);if(K===ne||!k)return w(K);w(`${K} - ${ne}`)},S=l=>{let u=new Date(l),s=u.toLocaleString("default",{month:"short"}),i=u.getDate(),a=u.getFullYear();return`${i} ${s} ${a}`};E.useEffect(()=>{J("Photos")&&M("Camera",{action:"getImages"},U.Photos.sort((l,u)=>u.timestamp-l.timestamp).reverse()).then(l=>{if(!l)return v("warning","No data was returned from getImages event");T(l.reverse()),I(l.length===0)})},[]);const h=l=>{var i;if(m(),B||g)return;let u=document.querySelector("#last");if(!u)return;if(!Z(u)){const a=document.querySelector(".library-content");a||v("warning","Could not find library content element");const y=a==null?void 0:a.scrollHeight;b(!0),M("Camera",{action:"getImages",lastId:(i=A[0])==null?void 0:i.id},null).then(L=>{L&&L.length>0?(a.style.transform=`translateY(${y}px)`,T([...L.reverse(),...A]),b(!1),requestAnimationFrame(()=>{a.style.transition="transform 0ms",a.style.transform="translateY(0)"}),L.length<30&&d(!0)):d(!0)})}};return C(x.div,{...ae("left","library"),className:"library-wrapper",children:[e("div",{className:"library-header",children:C("div",{className:"top",children:[e("div",{className:"info",children:e("div",{className:"date",style:{color:A.length<15?"var(--tablet-text-primary)":"#ffffff"},children:P&&P})}),e("div",{className:"actions",children:e("div",{className:"button",onClick:()=>D.set(!t),children:t?o("APPS.PHOTOS.DONE"):o("APPS.PHOTOS.SELECT")})})]})}),e("div",{className:"library-content","data-offset":A.length<15,onScroll:h,children:e("div",{className:"library-grid","data-zoomlevel":"5",children:A.map((l,u)=>C("div",{id:u===0?"last":"",className:"grid-item","data-id":l.id,onClick:()=>{if(t){const i=c.find(a=>a.id===l.id);r(i?c.filter(a=>a.id!==l.id):[...c,l])}else V.set({activeImage:l,images:A})},children:[l.isVideo?e($,{src:l.src,showAdvanced:!t}):e("div",{className:"img",style:{backgroundImage:`url(${l.src})`}}),e("div",{className:"checkbox",children:t&&(c.find(i=>i.id===l.id)?e(j,{checked:!0}):e(j,{checked:!1}))})]}))})}),t&&C("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":c.length===0,children:e(oe,{})}),e("div",{className:"title",children:c.length===0?o("APPS.PHOTOS.SELECT_ITEMS"):o("APPS.PHOTOS.SELECTED_COUNT",{count:c.length})}),C("div",{className:"icons","data-disabled":c.length===0,children:[e(ie,{onClick:()=>{c.length!==0&&H.ContextMenu.set({buttons:[{title:o("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{M("Camera",{action:"deleteFromGallery",ids:c.map(l=>l.id)},!0).then(()=>{T(A.filter(u=>!c.find(s=>u.src===s.src))),r([]);let l=0;c.forEach(u=>{l+=u.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:l}),M("Camera",{action:"getAlbums"}).then(u=>{if(!u)return v("error","No data received from server");let s=z.map(i=>{const a=u.mediaTypes[i.id+"Photos"]??0,y=u.mediaTypes[i.id+"Videos"]??0;return{...i,count:a+y,photoCount:a,videoCount:y}});f.APPS.CAMERA.albums.set(u.albums),f.APPS.CAMERA.mediaTypes.set(s)})})}}]})}}),e(ye,{onClick:()=>{c.length!==0&&H.ContextMenu.set({buttons:[{title:o("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{F.set({images:c,onSelect:l=>{M("Camera",{action:"addToAlbum",album:l.id,ids:c.map(u=>u.id)},!0).then(u=>{if(!u)return v("error","Could not add to album, server returned false");r([]),D.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(s=>s.id===l.id?{...s,count:s.count+c.length,photoCount:s.photoCount+c.filter(i=>!i.isVideo).length,videoCount:s.videoCount+c.filter(i=>i.isVideo).length,cover:c[c.length-1].src}:s))})}})}},{title:o("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{M("Camera",{action:"toggleFavourites",ids:c.map(l=>l.id),favourite:!0},!0).then(l=>{if(!l)return v("error","Could not add to favourites, server returned false");r([]),D.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(u=>u.id==="favourites"?{...u,count:u.count+c.length,photoCount:u.photoCount+c.filter(s=>!s.isVideo).length,videoCount:u.videoCount+c.filter(s=>s.isVideo).length,cover:c[c.length-1].src}:u))})}}]})}})]})]})]})}function we(){var A,T,N;const t=R(F),c=R(f.APPS.CAMERA.albums);let r=(A=t==null?void 0:t.images)==null?void 0:A[(t==null?void 0:t.images.length)-1];return C(x.div,{initial:{opacity:0,scale:.9,y:250},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:250},className:"addtoalbum-container",children:[C("div",{className:"addtoalbum-header",children:[e("div",{}),e("div",{className:"title",children:o("APPS.PHOTOS.ADD_TO_ALBUM")}),e("div",{className:"cancel",onClick:()=>F.reset(),children:o("APPS.PHOTOS.CANCEL")})]}),C("div",{className:"addtoalbum-content",children:[C("div",{className:"preview",children:[W(r==null?void 0:r.src)?e($,{src:r==null?void 0:r.src,showAdvanced:!1}):e("img",{src:r==null?void 0:r.src}),e("div",{className:"title",children:o("APPS.PHOTOS.SELECTED_COUNT",{count:(T=t==null?void 0:t.images)==null?void 0:T.length})})]}),e("div",{className:"albums",children:(N=c==null?void 0:c.filter(I=>I.id!=="favourites"&&I.id!=="recents"))==null?void 0:N.map((I,O)=>C("div",{className:"album",onClick:()=>{t.onSelect(I),F.reset()},children:[e("div",{className:"cover",children:W(I.cover)?e($,{src:I.cover,showAdvanced:!1}):e("img",{src:I.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"})}),e("div",{className:"title",children:I.title}),e("div",{className:"count",children:I.count})]},O))})]})]})}function Ve(){const t=R(ee),[c,r]=E.useState([{icon:e(Re,{}),title:o("APPS.PHOTOS.LIBRARY"),value:"library"},{icon:e(Le,{}),title:o("APPS.PHOTOS.ALBUMS"),value:"albums"}]);return e("div",{className:"photos-footer",children:c.map((A,T)=>C("div",{className:"item","data-active":t===A.value,onClick:()=>{ee.set(A.value),A.value==="albums"&&t==="albums"&&(_!=null&&_.value)&&_.reset()},children:[A.icon,A.title]},T))})}const le=E.forwardRef((t,c)=>{const r=R(me),[A,T]=E.useState(!0),[N,I]=E.useState(!0);return E.useEffect(()=>{ue(t.src,O=>{I(O),O||T(!1)})},[]),e("img",{...t,ref:c,src:N?t.src:"https://www.slntechnologies.com/wp-content/uploads/2017/08/ef3-placeholder-image.jpg","data-isblurred":r.streamerMode&&!t.ignoreStreamerMode&&A,onClick:O=>{if(r.streamerMode&&!t.ignoreStreamerMode&&A){O.preventDefault(),O.stopPropagation(),T(!1);return}t!=null&&t.onClick&&t.onClick()}})}),ke=()=>{var h,l,u;const t=R(Q),c=R(me),[r,A]=E.useState(!0),T=E.useRef(!1),[N,I]=E.useState(0),O=E.useRef(null),G=E.useRef(null),P=R(V),[w,B]=E.useState(new Date(((l=(h=V==null?void 0:V.value)==null?void 0:h.activeImage)==null?void 0:l.timestamp)??0)),[d,g]=E.useState(((u=P==null?void 0:P.activeImage)==null?void 0:u.favourite)??!1),[b,p]=E.useState([]);let n=(P==null?void 0:P.images)??[];E.useEffect(()=>{if(!(P!=null&&P.activeImage))return v("warning","No active image when changing volume");if(P.activeImage.isVideo){const s=document.getElementById(P.activeImage.id);if(!s)return;s.volume=c.sound.volume}},[c.sound.volume]),E.useEffect(()=>{var i;if(!P)return;let s=n.findIndex(a=>a.id===P.activeImage.id);if(I(s),g(P.activeImage.favourite),P.activeImage.isVideo){const a=document.getElementById(P.activeImage.id);if(!a)return v("warning","Video Element not found (Carousel effect)");a.play(),a.volume=c.sound.volume}if(n.length>0){let a=[];s===0?a=n.slice(0,12):s===n.length-1?a=n.slice(n.length-12,n.length):s<6?a=n.slice(0,12):s>n.length-6?a=n.slice(n.length-12,n.length):a=n.slice(s-6,s+6),B(new Date((i=n==null?void 0:n[s])==null?void 0:i.timestamp)),p(a)}},[P==null?void 0:P.activeImage]);const m={pos:{startLeft:0,startX:0},onMouseDown:s=>{m.pos={startLeft:O.current.scrollLeft,startX:s.clientX},O.current.style.userSelect="none",document.addEventListener("mouseup",m.onMouseUp),document.addEventListener("mousemove",m.onMove)},onMove:s=>{if(!O.current)return;const i=s.clientX-m.pos.startX;O.current.scrollLeft=m.pos.startLeft-i;const a=O.current.getBoundingClientRect();(a.left-5>s.clientX||s.clientX>a.right-5)&&m.onMouseUp(),T.current=!0},onMouseUp:()=>{if(!O.current)return;O.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",m.onMouseUp),document.removeEventListener("mousemove",m.onMove);const s=O.current.clientWidth;let i=N;const a=O.current.scrollLeft-m.pos.startLeft;if(a>s/2&&i<n.length?i++:a<-s/2&&i>0&&i--,P.activeImage.id!==n[i].id&&P.activeImage.isVideo){const L=document.getElementById(P.activeImage.id);L&&(L.pause(),L.currentTime=0)}V.set({activeImage:n[i],images:n}),document.getElementById(n[i].id).scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{T.current=!1},100)}},S=s=>{P.activeImage.isVideo&&document.getElementById(P.activeImage.id).pause(),V.set({activeImage:s,images:n}),document.getElementById(s.id).scrollIntoView({behavior:"smooth",block:"center"})};return C(x.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.25},className:"activephoto-container",children:[e(X,{children:r&&C(x.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"back",onClick:()=>{H.Share.reset(),V.reset()},children:e(de,{})}),C("div",{className:"date",children:[w.toLocaleString([],{day:"2-digit",month:"long"}),e("span",{children:w.toLocaleTimeString(t.DateLocale,{hour:"numeric",minute:"numeric",hour12:c.time.twelveHourClock})})]}),e("div",{children:e(Pe,{onClick:()=>{H.ContextMenu.set({buttons:[{title:o("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{F.set({images:[P.activeImage],onSelect:s=>{M("Camera",{action:"addToAlbum",album:s.id,ids:[P.activeImage.id]},!0).then(i=>{if(!i)return v("error","Could not add to album, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(a=>a.id===s.id?{...a,count:a.count+1,photoCount:P.activeImage.isVideo?a.photoCount:a.photoCount+1,videoCount:P.activeImage.isVideo?a.videoCount+1:a.videoCount,cover:P.activeImage.src}:a))})}})}},{title:d?o("APPS.PHOTOS.REMOVE_FROM_FAVOURITES"):o("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{M("Camera",{action:"toggleFavourites",ids:[P.activeImage.id],favourite:!d}).then(s=>{if(!s)return v("error","Could not add to favourites, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(i=>i.id==="favourites"?{...i,count:i.count+1,photoCount:P.activeImage.isVideo?i.photoCount:i.photoCount+1,videoCount:P.activeImage.isVideo?i.videoCount+1:i.videoCount,cover:P.activeImage.src}:i))})}}]})}})})]})}),e("div",{className:"image-overflow",ref:O,onMouseDown:m.onMouseDown,style:{backgroundColor:r?"var(--tablet-color-primary)":"rgba(0, 0, 0)"},onClick:()=>{T.current||A(!r)},children:n==null?void 0:n.map((s,i)=>{const a=s.id===P.activeImage.id;return s.isVideo?e("video",{id:s.id,src:s.src,className:a?"active":null,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:y=>{a&&(y.target.scrollIntoView({block:"center"}),y.target.play())}},i):e(le,{id:s.id,src:s.src,className:a?"active":null,ignoreStreamerMode:!0,onLoad:y=>{a&&y.target.scrollIntoView({block:"center"})}},i)})}),e(X,{children:r&&C(x.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"photo-carousel",ref:G,children:b.map((s,i)=>s.isVideo?e("video",{src:s.src,"data-carousel":i,controls:!1,muted:!0,onClick:a=>S(s)},i):e(le,{src:s.src,"data-carousel":i,onClick:a=>S(s)},i))}),C("div",{className:"photo-bottom",children:[e(oe,{onClick:()=>{H.Share.set({type:"image",data:{src:P.activeImage.src,isVideo:P.activeImage.isVideo}})}}),e("div",{onClick:()=>{M("Camera",{action:"toggleFavourites",ids:[P.activeImage.id],favourite:!d},!0).then(s=>{if(!s)return v("warning","Failed to toggle favourite, server returned success false");g(!d),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(i=>i.id==="favourites"?{...i,count:d?i.count-1:i.count+1,photoCount:P.activeImage.isVideo?i.photoCount:d?i.photoCount-1:i.photoCount+1,videoCount:P.activeImage.isVideo?d?i.videoCount-1:i.videoCount+1:i.videoCount,cover:P.activeImage.src}:i))})},children:d?e(ce,{}):e(He,{})}),e(ie,{onClick:()=>{H.PopUp.set({title:o("APPS.PHOTOS.DELETE_IMAGE_POPUP.TITLE"),description:o("APPS.PHOTOS.DELETE_IMAGE_POPUP.DESCRIPTION"),buttons:[{title:o("APPS.PHOTOS.DELETE_IMAGE_POPUP.CANCEL")},{title:o("APPS.PHOTOS.DELETE_IMAGE_POPUP.PROCEED"),color:"red",cb:()=>{M("Camera",{action:"deleteFromGallery",ids:[P.activeImage.id]},!0).then(s=>{if(!s)return v("error","Could not delete from gallery, server returned false");V.reset(),M("Camera",{action:"getAlbums"}).then(i=>{if(!i)return v("error","No data received from server");let a=z.map(y=>{const L=i.mediaTypes[y.id+"Photos"]??0,k=i.mediaTypes[y.id+"Videos"]??0;return{...y,count:L+k,photoCount:L,videoCount:k}});f.APPS.CAMERA.albums.set(i.albums),f.APPS.CAMERA.mediaTypes.set(a)})})}}]})}})]})]})})]})},ee=q("albums"),D=q(!1),V=q(null),F=q(null),Be={library:e(De,{}),albums:e(_e,{})},Ge=[2,3,4,5];function Ye(){const t=R(ee),c=R(V),r=R(D),A=R(F);return C("div",{className:"photos-container",children:[e("div",{className:"photos-content",style:{pointerEvents:c?"none":"all"},children:Be[t]}),!r&&e(Ve,{}),e(X,{children:c&&e(ke,{})}),e(X,{children:A&&e(we,{})})]})}export{V as ActiveImage,F as AlbumPickerComponent,D as SelectMode,ee as View,Ye as default,Ge as zoomLevels};
