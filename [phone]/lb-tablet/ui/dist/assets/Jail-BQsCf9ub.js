import{u as h,r as u,k as L,bu as O,N as l,y,a3 as x,n as D,j as s,o as f,af as F,a as t,L as i,h as M,O as H,bj as B,be as j,F as k,bB as g,bw as U,bC as b,a2 as w,bD as T,i as N,C as K,Y as V,a6 as G,bf as Y,bh as q}from"./index-CFbY8QCl.js";const o=y([]),P=y(null);function Q(){var C;const a=h(o),I=h(P),A=h(w.APPS.POLICE.permissions),[c,m]=u.useState(""),[S,J]=u.useState("");u.useEffect(()=>{L("Police",{action:"getJailees",query:c},O.jail.filter(e=>e.name.toLowerCase().includes(c.toLowerCase()))).then(e=>{if(!e)return l("warning","No data received");o.set(e)})},[c]);const{handleScroll:R}=x({fetchData:()=>L("Police",{action:"getJailees",query:c,lastId:a[a.length-1].id}),onDataFetched:e=>o.set([...o.value,...e]),perPage:10});u.useEffect(()=>{const e=setTimeout(()=>m(S),500);return()=>clearTimeout(e)},[S]);const p=e=>{L("Police",{action:"getJailee",id:e},O.jail.find(d=>d.id===e)).then(d=>{if(!d)return l("warning","No data received");P.set(d)})},v=()=>{let e={};T.set({type:"profiles",filter:"excludeJailed",onSelect:r=>{e.id=r.id,N.PopUp.set({title:i("APPS.POLICE.JAIL.JAIL_PERSON.TITLE"),description:i("APPS.POLICE.JAIL.JAIL_PERSON.DESCRIPTION",{name:r==null?void 0:r.name}),inputs:[{type:"number",placeholder:i("APPS.POLICE.JAIL.JAIL_PERSON.SENTENCE_PLACEHOLDER"),min:"1",onChange:E=>{e.sentence=parseInt(E)}}],textarea:{placeholder:i("APPS.POLICE.JAIL.JAIL_PERSON.REASON_PLACEHOLDER"),maxCharacters:500,onChange:E=>{e.description=E}},buttons:[{title:i("APPS.POLICE.CANCEL")},{title:"Next",cb:()=>d()}]})}});const d=()=>{N.ContextMenu.set({buttons:[{title:i("APPS.POLICE.JAIL.JAIL_PERSON.JAIL_WITH_INCIDENT"),color:"red",cb:()=>{if(!e.sentence||!e.description){setTimeout(()=>{N.PopUp.set({title:i("APPS.POLICE.JAIL.ERROR.TITLE"),description:i("APPS.POLICE.JAIL.ERROR.MISSING_DETAILS"),buttons:[{title:i("APPS.POLICE.OK")}]})},300),l("error","No sentence or description provided");return}T.set({type:"cases",onSelect:r=>{e.case={id:r.id,label:r.label},n({id:e.id,sentence:e.sentence,reason:e.description,case:e.case})}})}},{title:i("APPS.POLICE.JAIL.JAIL_PERSON.JAIL_WITHOUT_INCIDENT"),cb:()=>{if(!e.sentence||!e.description){setTimeout(()=>{N.PopUp.set({title:i("APPS.POLICE.JAIL.ERROR.TITLE"),description:i("APPS.POLICE.JAIL.ERROR.MISSING_DETAILS"),buttons:[{title:i("APPS.POLICE.OK")}]})},300),l("error","No sentence or description provided");return}n({id:e.id,sentence:e.sentence,reason:e.description})}}]})},n=r=>{if(!r.id)return l("error","No id provided");if(!r.reason&&r.reason.length>10)return l("error","No reason provided / reason is below 10 characters");if(!r.sentence&&r.sentence>0)return l("error","No sentence provided / sentence is below 0");L("Police",{action:"jailPlayer",data:{id:r.id,description:r.reason,case:r.case,sentence:r.sentence}},!0).then(E=>{if(!E)return l("error","Failed to jail person");l("info","Successfully jailed person")})}};return D("police:newPrisoner",e=>{if(!e)return l("error","No data received for police:newPrisoner");o.set([e,...o.value])}),D("police:prisonerReleased",e=>{if(!e)return l("error","No data received for police:prisonerReleased");o.set(o.value.filter(d=>d.id!==e))}),s(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:I?s(F,{children:s(W,{})}):s("main",{className:"main profiles",children:t("div",{className:"page",children:[t("div",{className:"top",children:[s("div",{className:"title",children:i("APPS.POLICE.JAIL.TITLE")}),((C=A==null?void 0:A.jail)==null?void 0:C.create)&&t("div",{className:"button",onClick:v,children:[s(M,{}),i("APPS.POLICE.ADD")]})]}),s(H,{placeholder:i("APPS.POLICE.JAIL.SEARCH"),onChange:e=>J(e.target.value)}),t("div",{className:"items",onScroll:R,children:[a.length===0&&c.length==0&&s("div",{className:"no-results",children:i("APPS.POLICE.SEARCH_FOR",{query:i("APPS.POLICE.JAIL.JAILED_PERSON").toLowerCase()})}),a.length===0&&c.length>0&&s("div",{className:"no-results",children:i("APPS.POLICE.NO_RESULTS_FOR",{query:c})}),a.map((e,d)=>{let n=d===a.length-1?"last":"";return t(f.div,{...B,id:n,className:"item",onClick:()=>p(e.id),children:[s("img",{src:j(e.avatar,"profile")}),t("div",{className:"info",children:[s("div",{className:"name",children:e.name}),s("div",{className:"subtitle",children:e.description.substring(0,150)}),t("div",{className:"cards",children:[e.case&&t(k,{children:[t("div",{className:"card blue clickable",onClick:r=>{r.stopPropagation(),L("Police",{action:"getIncident",id:e.case.id},O.cases.find(E=>E.id===e.case.id)).then(E=>{if(!E)return l("error","Failed to fetch incident");g.set(E),U.set("cases")})},children:[e.case.label," (",e.case.id,")"]}),s("div",{className:"divider"})]}),s("div",{className:"card blue",children:i("APPS.POLICE.JAIL.JAILED_BY_NAME",{name:e==null?void 0:e.jailedBy})}),s("div",{className:"card red",children:i("APPS.POLICE.JAIL.REMAINING_TIME_DATE",{time:_(e.remainingTime),date:b(e.releasedAt)})})]})]})]},d)})]})]})})})}const W=()=>{var v,C,e,d;const a=h(P),I=h(K),A=h(w.APPS.POLICE.permissions),[c,m]=u.useState(!1),S=u.useRef(!1),J=()=>{if(!S.current){l("info","No changes have been made to the incident"),g.reset();return}L("Police",{action:"updateJailee",data:{id:a.id,description:a.description,case:a.case}}).then(n=>{n&&(o.set(o.value.map(r=>r.id===a.id?a:r)),P.reset())})},R=()=>{N.PopUp.set({title:i("APPS.POLICE.JAIL.UNJAIL_PERSON.TITLE"),description:i("APPS.POLICE.JAIL.UNJAIL_PERSON.DESCRIPTION",{name:a==null?void 0:a.name}),buttons:[{title:i("APPS.POLICE.CANCEL")},{title:i("APPS.POLICE.JAIL.UNJAIL_PERSON.PROCEED"),color:"red",cb:()=>{L("Police",{action:"unjail",id:a.id},!0).then(n=>{if(!n)return l("error","Failed to unjail person");o.set(o.value.filter(r=>r.id!==a.id)),P.reset()})}}]})};let p=u.useRef(!0);return u.useEffect(()=>{if(a){if(p.current){p.current=!1;return}S.current=!0}},[a]),s(f.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{ease:"easeInOut",duration:.25},className:"grid-container",children:a&&t(k,{children:[t("div",{className:"grid-header",children:[t("div",{className:"back",onClick:()=>P.reset(),children:[s(V,{})," ",i("APPS.POLICE.BACK")]}),t("div",{className:"buttons",children:[((v=A.jail)==null?void 0:v.unjail)&&((e=(C=I==null?void 0:I.Police)==null?void 0:C.Jail)==null?void 0:e.CanUnjail)&&!c&&s("div",{className:"button red",onClick:R,children:i("APPS.POLICE.JAIL.UNJAIL")}),c&&s("div",{className:"button red",onClick:()=>m(!1),children:i("APPS.POLICE.CANCEL")}),((d=A==null?void 0:A.jail)==null?void 0:d.edit)&&s("div",{className:"button",onClick:()=>{c?J():m(!0)},children:c?i("APPS.POLICE.SAVE"):i("APPS.POLICE.EDIT")})]})]}),t("div",{className:"grid-body",style:{gridTemplateAreas:`
                                'profile profile'
                                'description reports'
                                'description .'
                         `,overflowY:"auto",paddingBottom:"2rem"},children:[t("div",{className:"grid-item",style:{gridArea:"profile"},children:[s("div",{className:"top",children:s("div",{className:"title",children:i("APPS.POLICE.JAIL.PROFILE")})}),s("div",{className:"items",children:t("div",{className:"item profile",children:[t("div",{className:"left",children:[s("div",{className:"mugshot",children:s("img",{src:j(a.avatar,"profile"),onClick:()=>{a.avatar&&N.FullscreenImage.set(a.avatar)}})}),s("div",{className:"info",children:s("div",{className:"name",children:a.name})})]}),t("div",{className:"details",children:[t("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.JAILED_BY")}),s("div",{className:"value",children:a.jailedBy})]}),t("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.JAILED_AT")}),s("div",{className:"value",children:b(a.jailedAt)})]}),t("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.REMAINING_TIME")}),s("div",{className:"value",children:_(a.remainingTime)})]}),t("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.ORIGINAL_SENTENCE")}),s("div",{className:"value",children:_(a.originalTime)})]}),t("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.RELEASE_DATE")}),s("div",{className:"value",children:b(a.releasedAt)})]})]})]})})]}),t("div",{className:"grid-item",style:{gridArea:"description",height:"20vh"},children:[s("div",{className:"top",children:s("div",{className:"title",children:i("APPS.POLICE.JAIL.DESCRIPTION")})}),s("div",{className:"items",children:s(G,{className:"note",placeholder:i("APPS.POLICE.JAIL.DESCRIPTION_PLACEHOLDER"),defaultValue:a.description,disabled:!c,onChange:n=>P.patch({description:n.target.value}),style:{height:"100%"}})})]}),t("div",{className:"grid-item",style:{gridArea:"reports"},children:[t("div",{className:"top",children:[s("div",{className:"title",children:i("APPS.POLICE.JAIL.LINKED_CASE")}),c&&t(f.div,{...Y,className:"button",onClick:()=>{T.set({type:"cases",onSelect:n=>{P.set({...P.value,case:{id:n.id,label:n.label}})}})},children:[s(M,{}),i("APPS.POLICE.ADD")]})]}),t("div",{className:"items",children:[!a.case&&s("div",{className:"no-results",children:i("APPS.POLICE.JAIL.NO_LINKED_CASE")}),s("div",{className:"cards",children:a.case&&t("div",{className:q("card blue clickable"),onClick:()=>{c?N.PopUp.set({title:i("APPS.POLICE.JAIL.REMOVE_LINKED_CASE.TITLE"),description:i("APPS.POLICE.JAIL.REMOVE_LINKED_CASE.DESCRIPTION"),buttons:[{title:i("APPS.POLICE.CANCEL")},{title:i("APPS.POLICE.REMOVE"),color:"red",cb:()=>{P.set({...P.value,case:null})}}]}):L("Police",{action:"getIncident",id:a.case.id},O.cases.find(n=>n.id===a.case.id)).then(n=>{if(!n)return l("error","Failed to fetch incident");g.set(n),U.set("cases")})},children:[a.case.label," (",a.case.id,")"]})})]})]})]})]})})},_=a=>{if(!a)return i("APPS.POLICE.MISC.UNKNOWN");if(a<0)return i("APPS.POLICE.JAIL.RELEASED");if(a<3600){const I=Math.floor(a/60);return I<1?i("APPS.POLICE.JAIL.LESS_THAN_MINUTE"):i("APPS.POLICE.MISC.MINUTES",{minutes:I.toString()})}if(a<86400){const I=Math.floor(a/3600);return i("APPS.POLICE.MISC.HOURS",{hours:I.toString()})}return i("APPS.POLICE.MISC.DAYS",{days:Math.floor(a/86400).toString()})};export{Q as default};
